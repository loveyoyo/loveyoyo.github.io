<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  SharedPreferences - Kang
  
  </title>
 <meta name="description" content="个人文章">
 <link href="atom.xml" rel="alternate" title="Kang" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">Kang</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Kang</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>四大组件</label></li>

          
            <li><a title="控制系统硬件功能" href="15603585084416.html">控制系统硬件功能</a></li>
          
            <li><a title="拍照和读取本地照片" href="15603582022474.html">拍照和读取本地照片</a></li>
          
            <li><a title="ContentProvider" href="15603581865930.html">ContentProvider</a></li>
          
            <li><a title="Service" href="15603581806506.html">Service</a></li>
          
            <li><a title="BroadcastReceiver" href="15603581707523.html">BroadcastReceiver</a></li>
          
            <li><a title="Activity" href="15598792154683.html">Activity</a></li>
          

      
        <li class="divider"></li>
        <li><label>Android组件</label></li>

          
            <li><a title="ScrollView和HorizontalView" href="15601389773513.html">ScrollView和HorizontalView</a></li>
          
            <li><a title="ViewPager" href="15601389699132.html">ViewPager</a></li>
          
            <li><a title="WebView" href="15601389648936.html">WebView</a></li>
          
            <li><a title="RecyclerView" href="15601389530971.html">RecyclerView</a></li>
          
            <li><a title="ListView" href="15590482064056.html">ListView</a></li>
          
            <li><a title="ProgressBar" href="15601389345357.html">ProgressBar</a></li>
          
            <li><a title="CheckBox和RadioButton" href="15601388701602.html">CheckBox和RadioButton</a></li>
          
            <li><a title="Spinner" href="15601388608282.html">Spinner</a></li>
          
            <li><a title="ImageView" href="15590447462728.html">ImageView</a></li>
          
            <li><a title="Button" href="15590305484634.html">Button</a></li>
          
            <li><a title="EditText" href="15587752872990.html">EditText</a></li>
          
            <li><a title="TextView" href="15584534943886.html">TextView</a></li>
          
            <li><a title="View" href="15587797736951.html">View</a></li>
          
            <li><a title="序" href="15584059143309.html">序</a></li>
          

      
        <li class="divider"></li>
        <li><label>Android Studio技巧</label></li>

          
            <li><a title="Android Studio使用小技巧" href="15586135036171.html">Android Studio使用小技巧</a></li>
          

      
        <li class="divider"></li>
        <li><label>Android其他</label></li>

          
            <li><a title="" href="15603582307379.html"></a></li>
          
            <li><a title="拍照和读取本地照片" href="15603582022474.html">拍照和读取本地照片</a></li>
          
            <li><a title="SharedPreferences" href="15601718627780.html">SharedPreferences</a></li>
          
            <li><a title="Permissions权限" href="15597992631758.html">Permissions权限</a></li>
          
            <li><a title="res文件夹中的资源" href="15597050707116.html">res文件夹中的资源</a></li>
          
            <li><a title="Manifest清单文件" href="15596519462062.html">Manifest清单文件</a></li>
          
            <li><a title="动画" href="15591315255964.html">动画</a></li>
          
            <li><a title="Style和Theme" href="15591171572096.html">Style和Theme</a></li>
          

      
        <li class="divider"></li>
        <li><label>React-Native</label></li>

          
            <li><a title="react-navigation" href="15584071613702.html">react-navigation</a></li>
          

      
        <li class="divider"></li>
        <li><label>随想</label></li>

          
            <li><a title="年年岁岁 碎碎念念" href="15600901474068.html">年年岁岁 碎碎念念</a></li>
          
            <li><a title="陌上归--序" href="15595397108681.html">陌上归--序</a></li>
          
            <li><a title="for" href="15583472660662.html">for</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>四大组件</span></li>
                        
                          <li><a title="控制系统硬件功能" href="15603585084416.html">控制系统硬件功能</a></li>
                        
                          <li><a title="拍照和读取本地照片" href="15603582022474.html">拍照和读取本地照片</a></li>
                        
                          <li><a title="ContentProvider" href="15603581865930.html">ContentProvider</a></li>
                        
                          <li><a title="Service" href="15603581806506.html">Service</a></li>
                        
                          <li><a title="BroadcastReceiver" href="15603581707523.html">BroadcastReceiver</a></li>
                        
                          <li><a title="Activity" href="15598792154683.html">Activity</a></li>
                        

                    
                      <li class="side-title"><span>Android组件</span></li>
                        
                          <li><a title="ScrollView和HorizontalView" href="15601389773513.html">ScrollView和HorizontalView</a></li>
                        
                          <li><a title="ViewPager" href="15601389699132.html">ViewPager</a></li>
                        
                          <li><a title="WebView" href="15601389648936.html">WebView</a></li>
                        
                          <li><a title="RecyclerView" href="15601389530971.html">RecyclerView</a></li>
                        
                          <li><a title="ListView" href="15590482064056.html">ListView</a></li>
                        
                          <li><a title="ProgressBar" href="15601389345357.html">ProgressBar</a></li>
                        
                          <li><a title="CheckBox和RadioButton" href="15601388701602.html">CheckBox和RadioButton</a></li>
                        
                          <li><a title="Spinner" href="15601388608282.html">Spinner</a></li>
                        
                          <li><a title="ImageView" href="15590447462728.html">ImageView</a></li>
                        
                          <li><a title="Button" href="15590305484634.html">Button</a></li>
                        
                          <li><a title="EditText" href="15587752872990.html">EditText</a></li>
                        
                          <li><a title="TextView" href="15584534943886.html">TextView</a></li>
                        
                          <li><a title="View" href="15587797736951.html">View</a></li>
                        
                          <li><a title="序" href="15584059143309.html">序</a></li>
                        

                    
                      <li class="side-title"><span>Android Studio技巧</span></li>
                        
                          <li><a title="Android Studio使用小技巧" href="15586135036171.html">Android Studio使用小技巧</a></li>
                        

                    
                      <li class="side-title"><span>Android其他</span></li>
                        
                          <li><a title="" href="15603582307379.html"></a></li>
                        
                          <li><a title="拍照和读取本地照片" href="15603582022474.html">拍照和读取本地照片</a></li>
                        
                          <li><a title="SharedPreferences" href="15601718627780.html">SharedPreferences</a></li>
                        
                          <li><a title="Permissions权限" href="15597992631758.html">Permissions权限</a></li>
                        
                          <li><a title="res文件夹中的资源" href="15597050707116.html">res文件夹中的资源</a></li>
                        
                          <li><a title="Manifest清单文件" href="15596519462062.html">Manifest清单文件</a></li>
                        
                          <li><a title="动画" href="15591315255964.html">动画</a></li>
                        
                          <li><a title="Style和Theme" href="15591171572096.html">Style和Theme</a></li>
                        

                    
                      <li class="side-title"><span>React-Native</span></li>
                        
                          <li><a title="react-navigation" href="15584071613702.html">react-navigation</a></li>
                        

                    
                      <li class="side-title"><span>随想</span></li>
                        
                          <li><a title="年年岁岁 碎碎念念" href="15600901474068.html">年年岁岁 碎碎念念</a></li>
                        
                          <li><a title="陌上归--序" href="15595397108681.html">陌上归--序</a></li>
                        
                          <li><a title="for" href="15583472660662.html">for</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>SharedPreferences</h1>

<h2 id="toc_0">简介</h2>

<p>&emsp;&emsp;首先应该表明SharedPreferences是一个接口，就是interface，而不是一个class。SharedPreferences是一个轻量级的存储接口,原理是使用xml文件存放键值对数据，文件存放在/data/data/<package-name>/shred-prefs目录下。使用SharedPreferences接口中的内部接口Editor的方法，可以存放String、set、int、long、float、boolean类型的数据，通过SharedPreferences中的方法进行读取以上几种类型的数据。</p>

<p>使用SharedPreferences进行键值对的存储和读取有三种方式获取SharedPreferences对象：<br/>
(1).SharedPreferences pre = Context.getSharedPreferences(String name,int mode);<br/>
&emsp;&emsp;使用该方法，配置的xml文件名字是参数中的name字段，如果该文件不存在，就创建，如果已经存在就直接使用，在填写name字段时，不要添加&quot;.xml&quot;后缀，系统会自动添加后缀。<br/>
(2).SharedPreferences pre = Activity.getPreferences(int mode);<br/>
&emsp;&emsp;使用该方法，配置的xml文件名字是使用当前类名；<br/>
(3).SharedPreferences pre = PreferenceManager.getDefaultSharedPreferences(Context);<br/>
&emsp;&emsp;首先需要知道，每个应用都有一个默认的配置文件preferences.xml。使用该方法，就是使用那个默认的配置文件；</p>

<p>getSharedPreferences（） 是Context类中的方法，可以指定file name以及 mode；<br/>
getPreferences（）是Activity类中的方法，只需指定mode；<br/>
getSharedPreferences（）是使用自定义的xml文件；<br/>
getDefaultSharedPreferences（）是使用应用默认xml文件；</p>

<p>注意：参数mode字段是操作模式，默认的模式为0或者是字段MODE_PRIVATE，还可以使用MODE_APPEND、MODE_WORLD_READABLE和MODE_WRITEABLE；</p>

<table>
<thead>
<tr>
<th style="text-align: center">类型</th>
<th style="text-align: center">解释</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">MODE_PRIVATE</td>
<td style="text-align: center">该配置文件只能被自己的应用程序访问；</td>
</tr>
<tr>
<td style="text-align: center">MODE_WORLD_READABLE</td>
<td style="text-align: center">该配置文件除了自己访问外，还可以被其他应用程序读取；</td>
</tr>
<tr>
<td style="text-align: center">MODE_WORLD_WRITEABLE</td>
<td style="text-align: center">该配置文件除了自己访问外，还可以被其他应用程序读取和写入；</td>
</tr>
</tbody>
</table>

<p><font color=red>SharedPreferences的文件结构</font>：</p>

<pre class="line-numbers"><code class="language-java">public interface SharedPreferences {
    //监听接口；
    public interface OnSharedPreferenceChangeListener {
        void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key);
    }
    //Editor接口；
    public interface Editor {
        //存放String型数据；
        Editor putString(String key, @Nullable String value);
        Editor putStringSet(String key, @Nullable Set&lt;String&gt; values);
        //存放int型数据；
        Editor putInt(String key, int value);
        //存放long型数据；
        Editor putLong(String key, long value);
        //存放float型数据；
        Editor putFloat(String key, float value);
        //存放boolean型数据；
        Editor putBoolean(String key, boolean value);
        Editor remove(String key);
        Editor clear();
        //提交；
        boolean commit();
        //应用；
        void apply();
    }
    
    Map&lt;String, ?&gt; getAll();
    //获取String类型数据；
    @Nullable
    String getString(String key, @Nullable String defValue);
    @Nullable
    Set&lt;String&gt; getStringSet(String key, @Nullable Set&lt;String&gt; defValues);
    //获取int型数据；
    int getInt(String key, int defValue);
    //获取long型数据；；
    long getLong(String key, long defValue);
    //获取float型数据；
    float getFloat(String key, float defValue);
    //获取boolean型数据；
    boolean getBoolean(String key, boolean defValue);
    boolean contains(String key);
    Editor edit();
    void registerOnSharedPreferenceChangeListener(OnSharedPreferenceChangeListener listener);
    void unregisterOnSharedPreferenceChangeListener(OnSharedPreferenceChangeListener listener);
}
</code></pre>

<p><font color=red>PreferenceManager的文件结构</font>:</p>

<pre class="line-numbers"><code class="language-java">public class PreferenceManager {
    public interface OnPreferenceTreeClickListener {
        boolean onPreferenceTreeClick(PreferenceScreen preferenceScreen, Preference preference);
    }
    public interface OnActivityResultListener {
        boolean onActivityResult(int requestCode, int resultCode, Intent data);
    }
    public interface OnActivityStopListener {
        void onActivityStop();
    }
    public interface OnActivityDestroyListener {
        void onActivityDestroy();
    }
    
    //获取SharedPreferences对象；
    public SharedPreferences getSharedPreferences() {
        if (mPreferenceDataStore != null) {
            return null;
        }
        if (mSharedPreferences == null) {
            final Context storageContext;
            switch (mStorage) {
                case STORAGE_DEVICE_PROTECTED:
                    storageContext = mContext.createDeviceProtectedStorageContext();
                    break;
                case STORAGE_CREDENTIAL_PROTECTED:
                    storageContext = mContext.createCredentialProtectedStorageContext();
                    break;
                default:
                    storageContext = mContext;
                    break;
            }
            mSharedPreferences = storageContext.getSharedPreferences(mSharedPreferencesName,
                    mSharedPreferencesMode);
        }
        return mSharedPreferences;
    }
    //获取SharedPreferences对象；
    public static SharedPreferences getDefaultSharedPreferences(Context context) {
        return context.getSharedPreferences(getDefaultSharedPreferencesName(context),
                getDefaultSharedPreferencesMode());
    }
    //获取SharedPreferences文件名字；
    public static String getDefaultSharedPreferencesName(Context context) {
        return context.getPackageName() + &quot;_preferences&quot;;
    }
    //获取SharedPreferences的读取类型；
    private static int getDefaultSharedPreferencesMode() {
        return Context.MODE_PRIVATE;
    }
}
</code></pre>

<h2 id="toc_1">SharedPreferences的使用流程</h2>

<h4 id="toc_2">一、<font color=red>保存键值对的步骤</font>：</h4>

<p>(1).获得SharedPreferences对象；<br/>
(2).获得SharedPreferences.Editor对象；<br/>
(3).通过SharedPreferences.Editor接口的putXxx（）方法存放key-value对（其中Xxx表示不同的数据类型。如：字符串类型的value需要用putString（）方法）；<br/>
(4).通过SharedPreferences.Editor接口的commit（）方法或者apply（）方法保存key-value对（commit方法相当于数据库事务中的提交（commit）操作）；</p>

<p><font color=red>commit()和apply()的区别</font>：<br/>
(1).apply()没有返回值，而commit()返回boolean表明修改是否提交成功；<br/>
(2).apply是将修改数据原子提交到内存, 而后异步真正提交到硬件磁盘, 而commit是同步的提交到硬件磁盘，因此，在多个并发的提交commit的时候，他们会等待正在处理的commit保存到磁盘后在操作，从而降低了效率。而apply只是原子的提交到内容，后面有调用apply的函数的将会直接覆盖前面的内存数据，这样从一定程度上提高了很多效率。<br/>
(3).apply方法不会提示任何失败的提示。 由于在一个进程中，sharedPreference是单实例，一般不会出现并发冲突，如果对提交的结果不关心的话，建议使用apply，当然需要确保提交成功且有后续操作的话，还是需要用commit的。</p>

<h4 id="toc_3">二、<font color=red>读取键值对的步骤</font>：</h4>

<p>(1).获得SharedPreferences对象；<br/>
(2).调用SharedPreferences对象的getXxx()方法来获取数据；</p>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15603581707523.html"  title="Previous Post: BroadcastReceiver">&laquo; BroadcastReceiver</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15600901474068.html" 
	        title="Next Post: 年年岁岁 碎碎念念">年年岁岁 碎碎念念 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15601718627780.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
